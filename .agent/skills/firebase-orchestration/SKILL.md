---
name: firebase-orchestration
description: Firestore を使用したリアルタイム通信（BBS、カウンター）の実装と、データの整合性を維持するためのスキル
---

# Firebase Orchestration Skill

このスキルは、サーバーレスなリアルタイム機能を、レトロな UI 体験と融合させながら安全に実装するためのガイドラインです。

## 🔥 実装コア

### 1. リアルタイム・サブスクリプション
- `onSnapshot` を使用し、BBS などの投稿をリロードなしで反映させる。
- コンポーネントのアンマウント時に必ずリスナーを解除 (`unsubscribe`) する。

### 2. データ構造の設計
- **BBS**: `createdAt` によるソートを基本とし、ID によるユニーク性を確保。
- **Counter**: セッションベースの増分制御による、過剰なカウントアップの防止。
- **Gallery**: Firestore でメタデータ（タイトル、説明、URL）を管理し、画像の実体は Storage に置く。

### 3. ストレージ・オーケストレーション
- `ref(storage, path)` と `getDownloadURL(ref)` を使用して画像のパブリック URL を取得。
- 大容量の画像は、Firestore に保存した `downloadURL` をキャッシュとして利用し、リクエスト回数を削減する。

### 4. セキュリティ
- セキュリティルールにおいて、許可されたパス (`/messages`, `/counter`, `/gallery`) 以外へのアクセスを制限。
- クライアント側での簡易バリデーションと、Firebase 側でのスキーマチェックの併用。

## 🛠 ベストプラクティス
- **ローカルステートとの同期**: サーバーからのデータ取得と、React の `useState` への反映をスムーズに行う。
- **エッジケース対応**: 画像のロード失敗時には、レトロな「NO IMAGE」GIF などを表示するフォールバックを実装。
- **エラーハンドリング**: 接続切れやパーミッションエラー時のユーザーへの適切な通知。

## 🚫 禁止事項
- **APIキーのハードコード**: 必ず環境変数から読み込むこと。
- **無限ループ**: `useEffect` 内での過剰な書き込みによる、読み書き回数の増大（クォータの浪費）に注意する。
